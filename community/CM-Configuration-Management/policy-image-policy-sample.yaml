apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: image-policy
  annotations:
    policy.open-cluster-management.io/standards: NIST SP 800-53
    policy.open-cluster-management.io/categories: CM Configuration Management
    policy.open-cluster-management.io/controls: CM-2 Baseline Configuration
    integrityshield.io/message: H4sIAAAAAAAAA5VVTW/bMAy9+1cIOQ5V120YMPjWZsPQQ4eiKXYZdmAkOtEiS54kezWG/fdRcpQPJ2lanhKKfCTfkylo1Hd0XllTssZqJfpL26DhQrc+oOM1GFhgjSZcKvu2e1eslJElu0+hRY0BJAQoC8YM1FgyVVM4H5DICcbYAIHgfYxhL6jhAxgJTvqSfbudPbLZPft0dcU/fnhhvoCAC+sUEsD0jk2tqdSidakJdrcJfSmaNcFZnbD4e3YDHrUyuA9b+AZFnM9RnlTJdy1CIhVNZZ1AOpTKw1wjsVeB9tEzlOcB60ZT12uKOLPzXyjCZ6yUUQkl+aPBa+XKiYNse13fZ5EG29Uy26GmHJ+AusVNUB4927MUbJKwQ6dCXzJt/4zq+QYEzlATA9btIjOGTzSnxH1nJGzVzpG/2XMrcyJWYgWtDjv+ge6xDNsMYelAgRH42DfER01cL6HDEfRp1bLtqieSFEk9v1TVWK9sg263UYGDs2OKZRuUW1+Lg/OxaNkcLpQPrp/ZlgTzx0JoCk2ioXwYYtWpsMhc3WfESyLxZNgmyKFcQqTifCgIatDnjOfQf7fQR0jOefHq72e97jTdyei9ob/KLI4svvlwwvcWYJPzHrDahm68fLQtR8Ue2vSdUc9fnW2bkn41/pl+C9+mK5gE4ccX8qbI1rHFP8vIAYdnOjrCYBrqkL4TnOSLukan/SXVzmvCGb0WoaXtPHl0LU7WdyCkz3TY9XI6Sr3uQOm4iLew+9umhiCWX54aR/drWyoW+7vCPq6z7oLRzLRFKYXdmgvWgW7je/NjIrGb/PxX/Af2xevmVwcAAA==
    integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEZCQUFCQ2dBdkZpRUVkZENIUWpWblNBUmhaMytYbTBOT3crQXJsb2NGQW1CSzJURVJIR2RoYW1GdVFHcHcKTG1saWJTNWpiMjBBQ2drUW0wTk93K0FybG9mb2lRdi9ia0o0eTllNjZuTHE0enVpTFdPS0dHcTNqa01DU1h3VQp6ZlB3UDN2djV1R284Tnh5djA0NmczUjUyd0FyN3ZrYURIL0JrbldpeGdQdjVGWDhsMkVYWkNydVZXdm5DWWJ4CnE5aWlmM05MK24vZ3Zyc2xPQ1dKakx4UzJRVWcwTlVrNEtUMFIrUXBHMjNOdW5nZWhLNWhyYzhKT1V4R0FNeTAKSVRMVUx5YXprOG5QVG1qMWdtRVdZNXJWTXp4Sll6QnlZbE5MMEhVWWxyeFFZTnJYR294VXF1TGxGU3VRbVJvKwpPOFhpejBpSnRpcVovVFlHYWdCTnNnSkQrK0hkNVRhcG05bUhxWFhteUJabGQvMGYzcmpwQjl0Qjg0VkEvTGNxCll3MGxBdUE2QTBjTkcrK3dvZVVTMUZVRXg2TVRFQVJqSEJYdGJ1OXdsM3dxT21HVy9vY213MVU5WXpKbUExMUQKMUN2MTUrU3orakRaT21SbkRhQS9JVUZUYUJzUHY3WWROZ2ErcDVZUm0vUGpZdm1YY3gxVXZ5ZkdhbGtLdWluUQpUVlVyOTlPelc1R1ZRVE5YRWE3ei9obGdXZEhGZURLUlFXOXRQWTFpUUxoRmY0N2kzSCsvd3lvMzJ5a1RPL25UCkFTS0ZlMm1Kb0xKQUdhVUJZcXFkVDI0YU4yWmhQWENaCj0vd1o5Ci0tLS0tRU5EIFBHUCBTSUdOQVRVUkUtLS0tLQo=
spec:
  remediationAction: enforce
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: image-policy-example
        spec:
          remediationAction: enforce
          severity: low
          namespaceSelector:
            exclude:
              - kube-*
            include:
              - default
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: config.openshift.io/v1
                kind: Image
                metadata:
                  name: cluster
                spec:
                  registrySources:
                    allowedRegistries:
                      - myregistry.com
                      - registry.redhat.io
                      - registry.access.redhat.com
                      - quay.io
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: binding-image-policy
  annotations:
    integrityshield.io/message: H4sIAAAAAAAAA5VVTW/bMAy9+1cIOQ5V120YMPjWZsPQQ4eiKXYZdmAkOtEiS54kezWG/fdRcpQPJ2lanhKKfCTfkylo1Hd0XllTssZqJfpL26DhQrc+oOM1GFhgjSZcKvu2e1eslJElu0+hRY0BJAQoC8YM1FgyVVM4H5DICcbYAIHgfYxhL6jhAxgJTvqSfbudPbLZPft0dcU/fnhhvoCAC+sUEsD0jk2tqdSidakJdrcJfSmaNcFZnbD4e3YDHrUyuA9b+AZFnM9RnlTJdy1CIhVNZZ1AOpTKw1wjsVeB9tEzlOcB60ZT12uKOLPzXyjCZ6yUUQkl+aPBa+XKiYNse13fZ5EG29Uy26GmHJ+AusVNUB4927MUbJKwQ6dCXzJt/4zq+QYEzlATA9btIjOGTzSnxH1nJGzVzpG/2XMrcyJWYgWtDjv+ge6xDNsMYelAgRH42DfER01cL6HDEfRp1bLtqieSFEk9v1TVWK9sg263UYGDs2OKZRuUW1+Lg/OxaNkcLpQPrp/ZlgTzx0JoCk2ioXwYYtWpsMhc3WfESyLxZNgmyKFcQqTifCgIatDnjOfQf7fQR0jOefHq72e97jTdyei9ob/KLI4svvlwwvcWYJPzHrDahm68fLQtR8Ue2vSdUc9fnW2bkn41/pl+C9+mK5gE4ccX8qbI1rHFP8vIAYdnOjrCYBrqkL4TnOSLukan/SXVzmvCGb0WoaXtPHl0LU7WdyCkz3TY9XI6Sr3uQOm4iLew+9umhiCWX54aR/drWyoW+7vCPq6z7oLRzLRFKYXdmgvWgW7je/NjIrGb/PxX/Af2xevmVwcAAA==
    integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEZCQUFCQ2dBdkZpRUVkZENIUWpWblNBUmhaMytYbTBOT3crQXJsb2NGQW1CSzJURVJIR2RoYW1GdVFHcHcKTG1saWJTNWpiMjBBQ2drUW0wTk93K0FybG9mb2lRdi9ia0o0eTllNjZuTHE0enVpTFdPS0dHcTNqa01DU1h3VQp6ZlB3UDN2djV1R284Tnh5djA0NmczUjUyd0FyN3ZrYURIL0JrbldpeGdQdjVGWDhsMkVYWkNydVZXdm5DWWJ4CnE5aWlmM05MK24vZ3Zyc2xPQ1dKakx4UzJRVWcwTlVrNEtUMFIrUXBHMjNOdW5nZWhLNWhyYzhKT1V4R0FNeTAKSVRMVUx5YXprOG5QVG1qMWdtRVdZNXJWTXp4Sll6QnlZbE5MMEhVWWxyeFFZTnJYR294VXF1TGxGU3VRbVJvKwpPOFhpejBpSnRpcVovVFlHYWdCTnNnSkQrK0hkNVRhcG05bUhxWFhteUJabGQvMGYzcmpwQjl0Qjg0VkEvTGNxCll3MGxBdUE2QTBjTkcrK3dvZVVTMUZVRXg2TVRFQVJqSEJYdGJ1OXdsM3dxT21HVy9vY213MVU5WXpKbUExMUQKMUN2MTUrU3orakRaT21SbkRhQS9JVUZUYUJzUHY3WWROZ2ErcDVZUm0vUGpZdm1YY3gxVXZ5ZkdhbGtLdWluUQpUVlVyOTlPelc1R1ZRVE5YRWE3ei9obGdXZEhGZURLUlFXOXRQWTFpUUxoRmY0N2kzSCsvd3lvMzJ5a1RPL25UCkFTS0ZlMm1Kb0xKQUdhVUJZcXFkVDI0YU4yWmhQWENaCj0vd1o5Ci0tLS0tRU5EIFBHUCBTSUdOQVRVUkUtLS0tLQo=
placementRef:
  name: placement-image-policy
  kind: PlacementRule
  apiGroup: apps.open-cluster-management.io
subjects:
  - name: image-policy
    kind: Policy
    apiGroup: policy.open-cluster-management.io
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: placement-image-policy
  annotations:
    integrityshield.io/message: H4sIAAAAAAAAA5VVTW/bMAy9+1cIOQ5V120YMPjWZsPQQ4eiKXYZdmAkOtEiS54kezWG/fdRcpQPJ2lanhKKfCTfkylo1Hd0XllTssZqJfpL26DhQrc+oOM1GFhgjSZcKvu2e1eslJElu0+hRY0BJAQoC8YM1FgyVVM4H5DICcbYAIHgfYxhL6jhAxgJTvqSfbudPbLZPft0dcU/fnhhvoCAC+sUEsD0jk2tqdSidakJdrcJfSmaNcFZnbD4e3YDHrUyuA9b+AZFnM9RnlTJdy1CIhVNZZ1AOpTKw1wjsVeB9tEzlOcB60ZT12uKOLPzXyjCZ6yUUQkl+aPBa+XKiYNse13fZ5EG29Uy26GmHJ+AusVNUB4927MUbJKwQ6dCXzJt/4zq+QYEzlATA9btIjOGTzSnxH1nJGzVzpG/2XMrcyJWYgWtDjv+ge6xDNsMYelAgRH42DfER01cL6HDEfRp1bLtqieSFEk9v1TVWK9sg263UYGDs2OKZRuUW1+Lg/OxaNkcLpQPrp/ZlgTzx0JoCk2ioXwYYtWpsMhc3WfESyLxZNgmyKFcQqTifCgIatDnjOfQf7fQR0jOefHq72e97jTdyei9ob/KLI4svvlwwvcWYJPzHrDahm68fLQtR8Ue2vSdUc9fnW2bkn41/pl+C9+mK5gE4ccX8qbI1rHFP8vIAYdnOjrCYBrqkL4TnOSLukan/SXVzmvCGb0WoaXtPHl0LU7WdyCkz3TY9XI6Sr3uQOm4iLew+9umhiCWX54aR/drWyoW+7vCPq6z7oLRzLRFKYXdmgvWgW7je/NjIrGb/PxX/Af2xevmVwcAAA==
    integrityshield.io/signature: LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KCmlRSEZCQUFCQ2dBdkZpRUVkZENIUWpWblNBUmhaMytYbTBOT3crQXJsb2NGQW1CSzJURVJIR2RoYW1GdVFHcHcKTG1saWJTNWpiMjBBQ2drUW0wTk93K0FybG9mb2lRdi9ia0o0eTllNjZuTHE0enVpTFdPS0dHcTNqa01DU1h3VQp6ZlB3UDN2djV1R284Tnh5djA0NmczUjUyd0FyN3ZrYURIL0JrbldpeGdQdjVGWDhsMkVYWkNydVZXdm5DWWJ4CnE5aWlmM05MK24vZ3Zyc2xPQ1dKakx4UzJRVWcwTlVrNEtUMFIrUXBHMjNOdW5nZWhLNWhyYzhKT1V4R0FNeTAKSVRMVUx5YXprOG5QVG1qMWdtRVdZNXJWTXp4Sll6QnlZbE5MMEhVWWxyeFFZTnJYR294VXF1TGxGU3VRbVJvKwpPOFhpejBpSnRpcVovVFlHYWdCTnNnSkQrK0hkNVRhcG05bUhxWFhteUJabGQvMGYzcmpwQjl0Qjg0VkEvTGNxCll3MGxBdUE2QTBjTkcrK3dvZVVTMUZVRXg2TVRFQVJqSEJYdGJ1OXdsM3dxT21HVy9vY213MVU5WXpKbUExMUQKMUN2MTUrU3orakRaT21SbkRhQS9JVUZUYUJzUHY3WWROZ2ErcDVZUm0vUGpZdm1YY3gxVXZ5ZkdhbGtLdWluUQpUVlVyOTlPelc1R1ZRVE5YRWE3ei9obGdXZEhGZURLUlFXOXRQWTFpUUxoRmY0N2kzSCsvd3lvMzJ5a1RPL25UCkFTS0ZlMm1Kb0xKQUdhVUJZcXFkVDI0YU4yWmhQWENaCj0vd1o5Ci0tLS0tRU5EIFBHUCBTSUdOQVRVUkUtLS0tLQo=
spec:
  clusterConditions:
    - status: "True"
      type: ManagedClusterConditionAvailable
  clusterSelector:
    matchExpressions:
      - {key: env, operator: In, values: ["dev"]}
